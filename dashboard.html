<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LeadCall Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f1f5f9; min-height: 100vh; color: #1e293b; }
        .login-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #f1f5f9; display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .login-overlay.hidden { display: none; }
        .login-box { background: white; padding: 32px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 100%; max-width: 360px; text-align: center; }
        .login-logo { font-size: 24px; font-weight: 700; color: #2563eb; margin-bottom: 8px; }
        .login-subtitle { color: #64748b; font-size: 14px; margin-bottom: 24px; }
        .login-input { width: 100%; padding: 12px 16px; font-size: 16px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 16px; outline: none; }
        .login-input:focus { border-color: #2563eb; }
        .login-btn { width: 100%; padding: 12px; font-size: 16px; font-weight: 600; color: white; background: #2563eb; border: none; border-radius: 8px; cursor: pointer; }
        .login-btn:hover { background: #1d4ed8; }
        .login-error { color: #dc2626; font-size: 14px; margin-bottom: 16px; display: none; }
        .login-error.show { display: block; }
        .main-content { display: none; }
        .main-content.show { display: block; }
        .header { background: white; border-bottom: 1px solid #e2e8f0; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 20px; font-weight: 700; color: #2563eb; }
        .header-right { font-size: 14px; color: #64748b; }
        .container { max-width: 1400px; margin: 0 auto; padding: 24px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .kpi-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .kpi-value { font-size: 32px; font-weight: 700; color: #1e293b; margin-bottom: 4px; }
        .kpi-label { font-size: 14px; color: #64748b; }
        .kpi-card.highlight { background: linear-gradient(135deg, #2563eb, #1d4ed8); color: white; }
        .kpi-card.highlight .kpi-value, .kpi-card.highlight .kpi-label { color: white; }
        .kpi-card.success .kpi-value { color: #16a34a; }
        .kpi-card.danger .kpi-value { color: #dc2626; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 12px; }
        .section-title { font-size: 18px; font-weight: 600; }
        .header-actions { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
        .refresh-btn { padding: 8px 16px; font-size: 14px; background: white; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 6px; }
        .refresh-btn:hover { background: #f8fafc; }
        .filter-group { display: flex; gap: 4px; background: white; padding: 4px; border-radius: 8px; border: 1px solid #e2e8f0; }
        .filter-btn { padding: 6px 12px; font-size: 13px; background: transparent; border: none; border-radius: 6px; cursor: pointer; color: #64748b; transition: all 0.2s; }
        .filter-btn:hover { background: #f1f5f9; }
        .filter-btn.active { background: #2563eb; color: white; }
        .sort-select { padding: 8px 12px; font-size: 13px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer; color: #1e293b; }
        .sort-select:hover { border-color: #cbd5e1; }
        .leads-card { background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); overflow: hidden; }
        .leads-table { width: 100%; border-collapse: collapse; }
        .leads-table th { text-align: left; padding: 14px 16px; font-size: 12px; font-weight: 600; text-transform: uppercase; color: #64748b; background: #f8fafc; border-bottom: 1px solid #e2e8f0; }
        .leads-table td { padding: 14px 16px; font-size: 14px; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        .leads-table tr:last-child td { border-bottom: none; }
        .leads-table tr:hover { background: #f8fafc; }
        .lead-name { font-weight: 600; color: #1e293b; margin-bottom: 2px; }
        .lead-phone { font-size: 13px; color: #64748b; }
        .status-badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .status-new { background: #dbeafe; color: #1d4ed8; }
        .status-contacted { background: #fef3c7; color: #b45309; }
        .status-offer_sent { background: #e0e7ff; color: #4338ca; }
        .status-won { background: #dcfce7; color: #16a34a; }
        .status-lost { background: #fee2e2; color: #dc2626; }
        .budget-badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; }
        .budget-high { background: #dcfce7; color: #16a34a; }
        .budget-medium { background: #fef3c7; color: #b45309; }
        .budget-low { background: #f1f5f9; color: #64748b; }
        .urgency-today { color: #dc2626; font-weight: 600; }
        .urgency-this_week { color: #b45309; }
        .urgency-flexible { color: #64748b; }
        .action-select { padding: 6px 10px; font-size: 13px; border: 1px solid #e2e8f0; border-radius: 6px; background: white; cursor: pointer; }
        .action-select:hover { border-color: #cbd5e1; }
        .time-ago { font-size: 13px; color: #64748b; }
        .empty-state { padding: 48px; text-align: center; color: #64748b; }
        .empty-state h3 { margin-bottom: 8px; color: #475569; }
        .loading { padding: 48px; text-align: center; color: #64748b; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-overlay.show { display: flex; }
        .modal { background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal h2 { margin-bottom: 16px; font-size: 18px; }
        .modal-field { margin-bottom: 12px; }
        .modal-label { font-size: 12px; color: #64748b; text-transform: uppercase; margin-bottom: 4px; }
        .modal-value { font-size: 15px; color: #1e293b; }
        .modal-close { margin-top: 16px; padding: 10px 20px; background: #f1f5f9; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; }
        .modal-close:hover { background: #e2e8f0; }
        .modal-input { width: 100%; padding: 10px 14px; font-size: 15px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 12px; outline: none; }
        .modal-input:focus { border-color: #2563eb; }
        .modal-textarea { width: 100%; padding: 10px 14px; font-size: 15px; border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 12px; outline: none; min-height: 80px; resize: vertical; font-family: inherit; }
        .modal-btn { padding: 10px 20px; font-size: 14px; font-weight: 600; color: white; background: #2563eb; border: none; border-radius: 8px; cursor: pointer; margin-right: 8px; }
        .modal-btn:hover { background: #1d4ed8; }
        .modal-btn.secondary { background: #f1f5f9; color: #1e293b; }
        .modal-btn.secondary:hover { background: #e2e8f0; }
        .modal-btn.danger { background: #dc2626; }
        .modal-btn.danger:hover { background: #b91c1c; }
        .has-notes { color: #2563eb; font-size: 12px; margin-left: 4px; }
        @media (max-width: 768px) {
            .container { padding: 16px; }
            .kpi-grid { grid-template-columns: repeat(2, 1fr); }
            .leads-table th:nth-child(4), .leads-table td:nth-child(4) { display: none; }
            .section-header { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <div class="login-logo">LeadCall</div>
            <div class="login-subtitle">Bitte melden Sie sich an</div>
            <div class="login-error" id="loginError">Falsches Passwort</div>
            <input type="password" class="login-input" id="passwordInput" placeholder="Passwort" onkeypress="if(event.key==='Enter')checkLogin()">
            <button class="login-btn" onclick="checkLogin()">Anmelden</button>
        </div>
    </div>
    <div class="main-content" id="mainContent">
    <header class="header">
        <div class="logo">LeadCall</div>
        <div class="header-right">Mustermann Sanit√§r</div>
    </header>
    <div class="container">
        <div class="kpi-grid">
            <div class="kpi-card highlight"><div class="kpi-value" id="kpiLeads">-</div><div class="kpi-label">Neue Leads</div></div>
            <div class="kpi-card"><div class="kpi-value" id="kpiOffers">-</div><div class="kpi-label">Angebote</div></div>
            <div class="kpi-card success"><div class="kpi-value" id="kpiWon">-</div><div class="kpi-label">Gewonnen</div></div>
            <div class="kpi-card danger"><div class="kpi-value" id="kpiLost">-</div><div class="kpi-label">Verloren</div></div>
            <div class="kpi-card"><div class="kpi-value" id="kpiResponseTime">-</div><div class="kpi-label">‚åÄ Antwortzeit</div></div>
            <div class="kpi-card"><div class="kpi-value" id="kpiConversion">-</div><div class="kpi-label">Conversion</div></div>
        </div>
        <div class="section-header">
            <h2 class="section-title">Alle Anfragen</h2>
            <div class="header-actions">
                <div class="filter-group">
                    <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">Alle</button>
                    <button class="filter-btn" data-filter="new" onclick="setFilter('new')">Neu</button>
                    <button class="filter-btn" data-filter="offer_sent" onclick="setFilter('offer_sent')">Angebot</button>
                    <button class="filter-btn" data-filter="won" onclick="setFilter('won')">Gewonnen</button>
                    <button class="filter-btn" data-filter="lost" onclick="setFilter('lost')">Verloren</button>
                </div>
                <select class="sort-select" id="sortSelect" onchange="setSort(this.value)">
                    <option value="newest">Neueste zuerst</option>
                    <option value="oldest">√Ñlteste zuerst</option>
                    <option value="budget_high">Budget ‚Üì H√∂chste</option>
                    <option value="budget_low">Budget ‚Üë Niedrigste</option>
                    <option value="urgency">Dringlichkeit</option>
                </select>
                <button class="refresh-btn" onclick="loadData()">‚Üª Aktualisieren</button>
            </div>
        </div>
        <div class="leads-card">
            <table class="leads-table">
                <thead><tr><th>Kontakt</th><th>Anfrage</th><th>Dringlichkeit</th><th>Eingang</th><th>Budget</th><th>Status</th><th>Aktion</th></tr></thead>
                <tbody id="leadsTableBody"><tr><td colspan="7" class="loading">L√§dt...</td></tr></tbody>
            </table>
        </div>
    </div>
    <div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 id="modalTitle">Lead Details</h2>
            <div id="modalContent"></div>
            <button class="modal-close" onclick="closeModal()">Schlie√üen</button>
        </div>
    </div>
    <div class="modal-overlay" id="offerModal" onclick="closeOfferModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>Angebot gesendet</h2>
            <p style="color: #64748b; margin-bottom: 16px;">Wie hoch ist die Angebotssumme?</p>
            <input type="number" class="modal-input" id="offerAmount" placeholder="z.B. 2500" step="0.01">
            <div><button class="modal-btn" onclick="confirmOffer()">Speichern</button><button class="modal-btn secondary" onclick="closeOfferModal()">Abbrechen</button></div>
        </div>
    </div>
    <div class="modal-overlay" id="notesModal" onclick="closeNotesModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>Notizen</h2>
            <textarea class="modal-textarea" id="notesText" placeholder="Notizen zu diesem Lead..."></textarea>
            <div><button class="modal-btn" onclick="saveNotes()">Speichern</button><button class="modal-btn secondary" onclick="closeNotesModal()">Abbrechen</button></div>
        </div>
    </div>
    <div class="modal-overlay" id="deleteModal" onclick="closeDeleteModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <h2>Lead l√∂schen?</h2>
            <p style="color: #64748b; margin-bottom: 16px;">M√∂chtest du diesen Lead wirklich l√∂schen?</p>
            <div><button class="modal-btn danger" onclick="confirmDelete()">Ja, l√∂schen</button><button class="modal-btn secondary" onclick="closeDeleteModal()">Abbrechen</button></div>
        </div>
    </div>
    <script>
        const SUPABASE_URL = 'https://fbkkyzvumytipjtnrjrn.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZia2t5enZ1bXl0aXBqdG5yanJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NzM0MTMsImV4cCI6MjA4NTI0OTQxM30.FsdSHmWuyP5QiKqGbaDG6XZJiAzaOKdsbqgrXKrfQCk';
        const TENANT_ID = '38ead1f3-74be-4db3-a61b-27f9152d2478';
        const STATUS_LABELS = {'new': 'Neu', 'contacted': 'Kontaktiert', 'offer_sent': 'Angebot gesendet', 'won': 'Gewonnen', 'lost': 'Verloren'};
        const URGENCY_LABELS = {'today': 'Heute', 'this_week': 'Diese Woche', 'flexible': 'Flexibel'};
        const BUDGET_LABELS = {'under_500': 'Unter 500‚Ç¨', '500_2000': '500‚Ç¨ - 2.000‚Ç¨', '2000_5000': '2.000‚Ç¨ - 5.000‚Ç¨', 'over_5000': '√úber 5.000‚Ç¨', 'unknown': 'Unbekannt'};
        const BUDGET_VALUES = {'under_500': 250, '500_2000': 1250, '2000_5000': 3500, 'over_5000': 7500, 'unknown': 0};
        function getBudgetClass(b) { if (b === 'over_5000' || b === '2000_5000') return 'budget-high'; if (b === '500_2000') return 'budget-medium'; return 'budget-low'; }
        let allLeads = [], currentFilter = 'all', currentSort = 'newest', currentLeadId = null;
        async function supabaseGet(t, q = '') { const r = await fetch(`${SUPABASE_URL}/rest/v1/${t}?${q}`, {headers: {'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}`}}); return r.json(); }
        async function supabaseUpdate(t, id, d) { const r = await fetch(`${SUPABASE_URL}/rest/v1/${t}?id=eq.${id}`, {method: 'PATCH', headers: {'Content-Type': 'application/json', 'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}`, 'Prefer': 'return=representation'}, body: JSON.stringify(d)}); return r.json(); }
        async function supabaseDelete(t, id) { const r = await fetch(`${SUPABASE_URL}/rest/v1/${t}?id=eq.${id}`, {method: 'DELETE', headers: {'apikey': SUPABASE_ANON_KEY, 'Authorization': `Bearer ${SUPABASE_ANON_KEY}`}}); return r.ok; }
        function timeAgo(d) { if (!d) return '-'; const date = new Date(d), now = new Date(), s = Math.floor((now - date) / 1000); if (s < 60) return 'Gerade eben'; if (s < 3600) return `vor ${Math.floor(s / 60)} Min.`; if (s < 86400) return `vor ${Math.floor(s / 3600)} Std.`; if (s < 604800) return `vor ${Math.floor(s / 86400)} Tagen`; return date.toLocaleDateString('de-DE'); }
        function setFilter(f) { currentFilter = f; document.querySelectorAll('.filter-btn').forEach(b => b.classList.toggle('active', b.dataset.filter === f)); renderLeadsTable(allLeads); }
        function setSort(s) { currentSort = s; renderLeadsTable(allLeads); }
        function sortLeads(leads) {
            const sorted = [...leads];
            switch(currentSort) {
                case 'newest': sorted.sort((a, b) => new Date(b.created_at) - new Date(a.created_at)); break;
                case 'oldest': sorted.sort((a, b) => new Date(a.created_at) - new Date(b.created_at)); break;
                case 'budget_high': sorted.sort((a, b) => (BUDGET_VALUES[b.budget] || 0) - (BUDGET_VALUES[a.budget] || 0)); break;
                case 'budget_low': sorted.sort((a, b) => (BUDGET_VALUES[a.budget] || 0) - (BUDGET_VALUES[b.budget] || 0)); break;
                case 'urgency': const o = {'today': 0, 'this_week': 1, 'flexible': 2}; sorted.sort((a, b) => (o[a.urgency] ?? 3) - (o[b.urgency] ?? 3)); break;
            }
            return sorted;
        }
        async function loadData() {
            try {
                const leads = await supabaseGet('leads', `tenant_id=eq.${TENANT_ID}&order=created_at.desc`);
                allLeads = leads;
                const now = new Date(), thirtyDaysAgo = new Date(now - 30 * 24 * 60 * 60 * 1000);
                const recent = leads.filter(l => new Date(l.created_at) >= thirtyDaysAgo);
                const newL = recent.filter(l => l.status === 'new').length;
                const offers = recent.filter(l => l.offer_sent_at).length;
                const won = recent.filter(l => l.status === 'won').length;
                const lost = recent.filter(l => l.status === 'lost').length;
                const withOffer = recent.filter(l => l.offer_sent_at && l.created_at);
                let avgRT = '-';
                if (withOffer.length > 0) { const total = withOffer.reduce((sum, l) => sum + (new Date(l.offer_sent_at) - new Date(l.created_at)) / (1000 * 60 * 60), 0); const avg = total / withOffer.length; avgRT = avg < 24 ? `${Math.round(avg)}h` : `${Math.round(avg / 24)}d`; }
                const conv = recent.length > 0 ? Math.round((won / recent.length) * 100) : 0;
                document.getElementById('kpiLeads').textContent = newL;
                document.getElementById('kpiOffers').textContent = offers;
                document.getElementById('kpiWon').textContent = won;
                document.getElementById('kpiLost').textContent = lost;
                document.getElementById('kpiResponseTime').textContent = avgRT;
                document.getElementById('kpiConversion').textContent = `${conv}%`;
                renderLeadsTable(leads);
            } catch (err) { document.getElementById('leadsTableBody').innerHTML = `<tr><td colspan="7" class="empty-state">Fehler: ${err.message}</td></tr>`; }
        }
        function renderLeadsTable(leads) {
            const tbody = document.getElementById('leadsTableBody');
            let filtered = currentFilter === 'all' ? leads : leads.filter(l => l.status === currentFilter);
            filtered = sortLeads(filtered);
            if (filtered.length === 0) { tbody.innerHTML = `<tr><td colspan="7" class="empty-state"><h3>Keine Anfragen</h3></td></tr>`; return; }
            tbody.innerHTML = filtered.map(l => `
                <tr onclick="showDetail('${l.id}')" style="cursor: pointer;">
                    <td><div class="lead-name">${escapeHtml(l.name || 'Unbekannt')}${l.notes ? '<span class="has-notes">üìù</span>' : ''}</div><div class="lead-phone">${escapeHtml(l.phone || '-')}</div></td>
                    <td><div>${escapeHtml(l.service_type || '-')}</div>${l.company ? `<div class="lead-phone">${escapeHtml(l.company)}</div>` : ''}${l.offer_amount ? `<div class="lead-phone" style="color:#16a34a;font-weight:600">${parseFloat(l.offer_amount).toLocaleString('de-DE')} ‚Ç¨</div>` : ''}</td>
                    <td><span class="urgency-${l.urgency || 'flexible'}">${URGENCY_LABELS[l.urgency] || 'Flexibel'}</span></td>
                    <td><span class="time-ago">${timeAgo(l.created_at)}</span></td>
                    <td><span class="budget-badge ${getBudgetClass(l.budget)}">${BUDGET_LABELS[l.budget] || 'Unbekannt'}</span></td>
                    <td><span class="status-badge status-${l.status}">${STATUS_LABELS[l.status] || l.status}</span></td>
                    <td onclick="event.stopPropagation()"><select class="action-select" onchange="handleAction('${l.id}', this.value); this.value='';"><option value="">Aktion...</option><option value="contacted">‚Üí Kontaktiert</option><option value="offer_sent">‚Üí Angebot gesendet</option><option value="won">‚Üí Gewonnen ‚úì</option><option value="lost">‚Üí Verloren ‚úó</option><option value="notes">üìù Notizen</option><option value="delete">üóë L√∂schen</option></select></td>
                </tr>
            `).join('');
        }
        function handleAction(id, a) { if (!a) return; currentLeadId = id; if (a === 'offer_sent') openOfferModal(); else if (a === 'notes') openNotesModal(id); else if (a === 'delete') openDeleteModal(); else updateStatus(id, a); }
        async function updateStatus(id, s, extra = {}) { const d = {status: s, updated_at: new Date().toISOString(), ...extra}; if (s === 'offer_sent' && !extra.offer_sent_at) d.offer_sent_at = new Date().toISOString(); else if (s === 'won' || s === 'lost') d.closed_at = new Date().toISOString(); await supabaseUpdate('leads', id, d); loadData(); }
        function openOfferModal() { document.getElementById('offerAmount').value = ''; document.getElementById('offerModal').classList.add('show'); }
        function closeOfferModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('offerModal').classList.remove('show'); currentLeadId = null; }
        async function confirmOffer() { const amt = document.getElementById('offerAmount').value; await updateStatus(currentLeadId, 'offer_sent', {offer_amount: amt ? parseFloat(amt) : null, offer_sent_at: new Date().toISOString()}); closeOfferModal(); }
        function openNotesModal(id) { const l = allLeads.find(x => x.id === id); document.getElementById('notesText').value = l?.notes || ''; document.getElementById('notesModal').classList.add('show'); }
        function closeNotesModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('notesModal').classList.remove('show'); currentLeadId = null; }
        async function saveNotes() { const n = document.getElementById('notesText').value; await supabaseUpdate('leads', currentLeadId, {notes: n, updated_at: new Date().toISOString()}); loadData(); closeNotesModal(); }
        function openDeleteModal() { document.getElementById('deleteModal').classList.add('show'); }
        function closeDeleteModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('deleteModal').classList.remove('show'); currentLeadId = null; }
        async function confirmDelete() { await supabaseDelete('leads', currentLeadId); loadData(); closeDeleteModal(); }
        function showDetail(id) {
            const l = allLeads.find(x => x.id === id); if (!l) return;
            document.getElementById('modalContent').innerHTML = `
                <div class="modal-field"><div class="modal-label">Name</div><div class="modal-value">${escapeHtml(l.name || '-')}</div></div>
                <div class="modal-field"><div class="modal-label">Telefon</div><div class="modal-value"><a href="tel:${l.phone}">${escapeHtml(l.phone || '-')}</a></div></div>
                ${l.email ? `<div class="modal-field"><div class="modal-label">E-Mail</div><div class="modal-value"><a href="mailto:${l.email}">${escapeHtml(l.email)}</a></div></div>` : ''}
                ${l.company ? `<div class="modal-field"><div class="modal-label">Firma</div><div class="modal-value">${escapeHtml(l.company)}</div></div>` : ''}
                <div class="modal-field"><div class="modal-label">Anfrage</div><div class="modal-value">${escapeHtml(l.service_type || '-')}</div></div>
                ${l.description ? `<div class="modal-field"><div class="modal-label">Beschreibung</div><div class="modal-value">${escapeHtml(l.description)}</div></div>` : ''}
                <div class="modal-field"><div class="modal-label">Dringlichkeit</div><div class="modal-value">${URGENCY_LABELS[l.urgency] || 'Flexibel'}</div></div>
                <div class="modal-field"><div class="modal-label">Status</div><div class="modal-value"><span class="status-badge status-${l.status}">${STATUS_LABELS[l.status] || l.status}</span></div></div>
                ${l.budget ? `<div class="modal-field"><div class="modal-label">Budget</div><div class="modal-value">${BUDGET_LABELS[l.budget] || l.budget}</div></div>` : ''}
                <div class="modal-field"><div class="modal-label">Eingegangen</div><div class="modal-value">${new Date(l.created_at).toLocaleString('de-DE')}</div></div>
                ${l.offer_sent_at ? `<div class="modal-field"><div class="modal-label">Angebot gesendet</div><div class="modal-value">${new Date(l.offer_sent_at).toLocaleString('de-DE')}</div></div>` : ''}
                ${l.offer_amount ? `<div class="modal-field"><div class="modal-label">Angebotssumme</div><div class="modal-value" style="color:#16a34a;font-weight:600">${parseFloat(l.offer_amount).toLocaleString('de-DE')} ‚Ç¨</div></div>` : ''}
                ${l.notes ? `<div class="modal-field"><div class="modal-label">Notizen</div><div class="modal-value">${escapeHtml(l.notes)}</div></div>` : ''}
                ${l.image_urls && l.image_urls.length > 0 ? `<div class="modal-field"><div class="modal-label">Bilder</div><div class="modal-value" style="display:flex;gap:8px;flex-wrap:wrap">${l.image_urls.map(u => `<a href="${u}" target="_blank"><img src="${u}" style="width:100px;height:100px;object-fit:cover;border-radius:6px"></a>`).join('')}</div></div>` : ''}
            `;
            document.getElementById('modalOverlay').classList.add('show');
        }
        function closeModal(e) { if (e && e.target !== e.currentTarget) return; document.getElementById('modalOverlay').classList.remove('show'); }
        function escapeHtml(t) { if (!t) return ''; const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
        if (sessionStorage.getItem('loggedIn') === 'true') { document.getElementById('loginOverlay').classList.add('hidden'); document.getElementById('mainContent').classList.add('show'); loadData(); }
        setInterval(() => { if (sessionStorage.getItem('loggedIn') === 'true') loadData(); }, 30000);
    </script>
    </div>
    <script>
        function checkLogin() {
            const pw = document.getElementById('passwordInput').value;
            if (pw === 'passwort') { sessionStorage.setItem('loggedIn', 'true'); document.getElementById('loginOverlay').classList.add('hidden'); document.getElementById('mainContent').classList.add('show'); loadData(); }
            else { document.getElementById('loginError').classList.add('show'); document.getElementById('passwordInput').value = ''; }
        }
    </script>
</body>
</html>
